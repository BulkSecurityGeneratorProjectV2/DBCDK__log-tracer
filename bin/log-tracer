#!/bin/bash
#
# Copyright Dansk Bibliotekscenter a/s. Licensed under GPLv3
# See license text in LICENSE.md
#

log_tracer_home="$HOME/.log-tracer"
log_tracer_archive="${log_tracer_home}/archive"
log_tracer_bin="${log_tracer_home}/bin"

case "$1" in
    --version)
    cat ${log_tracer_home}/version
    ;;
    -h)
    echo "usage: log-tracer --version"
    echo "usage: log-tracer --selfupdate"
    java -jar ${log_tracer_archive}/log-tracer-current.jar -h
    ;;
    --selfupdate)
    tag=`curl -sL https://api.github.com/repos/DBCDK/log-tracer/releases/latest | jq -r ".tag_name"`
    curl -sL https://github.com/DBCDK/log-tracer/releases/download/${tag}/install.sh -o ${log_tracer_bin}/install.sh
    ${log_tracer_bin}/install.sh
    ;;
    *)
    java -jar ${log_tracer_archive}/log-tracer-current.jar ${LOG_TRACER_OPTS} "$@"
    ;;
esac
